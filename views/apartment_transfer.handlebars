{{> mainNav}}
{{> bottonNavigation}}

<div class="container-fluid">
  <div class="row">
  {{> apartmentValue}}

    <div class="col s12 l10 offset-l1">
      <div class="card circle z-depth-2">
        <div class="card-content black-text center">
          <span class="card-title center">Apartment Transfer</span>
          <div class="container-fluid">
            <div class="row">

              <form class="col s12" id="transfer" method="post" action="/transferApartmentSucc" name="form">
                <div class="row">

                  <div class="input-field col s6 l4 offset-l2">
                    <input id="amount" type="number" class="validate marginLess" name="amountTrans" style="margin: 0;">
                    <label for="amount" class="active">Amount</label>
                  </div>

                  <div class="input-field col s6 l4">
                    <input id="email" type="email" class="validate" name="recipientTrans" list="liger_email" style="margin: 0;">
                    <label for="email" class="active">e-mail</label>

                    <datalist id="liger_email">
                      {{#each emails}}
                        <option>{{this}}</option>
                      {{/each}}
                    </datalist>
                  </div>
                </div>

                <div class="row">
                  <div class="col s6 l4 offset-l2">
                    <center>  
                    <label id="amount-error" class="error red-text" for="amount"></label>
                    </center>
                  </div>

                  <div class="col s6 l4">
                    <center>
                      <label id="email-error" class="error red-text" for="email"></label>
                    </center>
                  </div>
                </div>

                <div class="row">
                  <div class="input-field col s12 l8 offset-l2">
                    <textarea id="reason" class="materialize-textarea validate" name="reasonTrans" data-length="200" data-error="Check it again" style="margin: 0;"></textarea>
                    <label for="reason">Reason</label>
                  </div>
                </div>

                <div class="row">
                  <div class="col s12 l8 offset-l2">
                    <center>
                      <label id="reason-error" class="error red-text" for="reason"></label>
                    </center>
                  </div>
                </div>

                <div class="row">
                  <div class="input-field col s6 m6 l4 offset-s2 offset-m3 offset-l4">
                      <a class="waves-effect waves-light btn center" href="#comfirm" onclick="check()">Submit</a>
                  </div>
                </div>

                <div id="comfirm" class="modal bottom-sheet">
                  <div class="modal-content hide-on-small-only">
                    <h3>Comfirmation</h3>
                    <h4 class="center">Are you sure that you want to transfer <a href="#amount" class="modal-action modal-close" id="amountInput">x</a>  to e-mail: <a href="mailto:" id="emailInput">someone@ligercambodia.org</a>?</h4>
                  </div>

                  <div class="modal-content show-on-small-only hide-on-med-and-up">
                    <h5>Comfirmation</h5>
                    <h6 class="center">Are you sure that you want to transfer <a href="#amount" class="modal-action modal-close" id="amountInput">x</a> to e-mail: <a href="mailto:" id="emailInput">someone@ligercambodia.org</a>?</h6>
                  </div>

                  <div class="modal-footer center">
                    <center>
                      <a href="#" class="modal-close waves-effect waves-black btn-flat amber">Disagree</a>
                      <button class="green waves-effect waves-black btn-flat" type="submit">Agree</button>
                    </center>
                  </div>
                </div>
              </form>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">  
function check(){
  var amount = document.getElementById('amount').value;
  var email = document.getElementById('email').value;

  document.getElementById('amountInput').innerHTML = "P 0" + amount;
  document.getElementById('emailInput').innerHTML = email;
}

$( document ).ready(function() {
  Materialize.updateTextFields();
});

$('textarea#reason').characterCounter();
$('.modal').modal();

$(function() {

  $.validator.addMethod('list', function(value, element){
    
    var email= [{{#each emails}} "{{this}}", {{/each}}];
    
    var wrong = 0;
    for(var i = 0; i < email.length; i++){
      if(value == email[i]){
        wrong = 1;
        break;
      }
    }
    return this.optional( element ) || wrong == 1;
  }, "Please write a better email!");

  $( "#transfer" ).validate({
    rules: {
      amountTrans: {
        required: true,
        min: 0,
        max: {{resultingBudget}},
        number: true
      },
      recipientTrans: {
        required: true,
        email: true,
        list: true
      },
      reasonTrans: {
        maxlength: 200,
        required: true
      }
    },
    messages:{
      amount: {
        required: "<span class='center'>Needed!<span>",
        min: "Please add an integer!",
        max: "It too much!",
        number: "Number please!"
      }
    },
    submitHandler: function(form) {
      $('button[type=submit').prop('disabled', true);
      $.ajax({
        url: form.action,
        type: form.method,
        data: $(form).serialize(),
        success: function(response) {
          $('button[type=submit').prop('disabled', false);
          Materialize.toast(response, 4000)
          if (response == "Success") {
            $('.modal').modal('close');
            location.reload();
          } 

        }
      });
    }
  });
});
</script>